"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[24321],{532465:(e,t,n)=>{function i(e,t,n){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:String(i))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:()=>o});let a=new class{constructor(){i(this,"onResumeListeners",[]),i(this,"onPauseListeners",[]),i(this,"inExp",!1),i(this,"windowInFocus",!0)}setExperiment(e=!1){this.inExp=e}onSessionResume(e){return this.onResumeListeners.push(e),this}onSessionPause(e){return this.onPauseListeners.push(e),this}removeResumeListener(e){this.onResumeListeners.filter(t=>t!==e)}removePauseListener(e){this.onPauseListeners=this.onPauseListeners.filter(t=>t!==e)}getAppState(){return this.windowInFocus?0:void 0}},r=e=>{if(e.isHidden){let{reason:t}=e;a.windowInFocus=!1,a.onPauseListeners.forEach(e=>e(t))}else a.windowInFocus=!0,a.onResumeListeners.forEach(e=>e())};setTimeout(()=>{window.addEventListener("beforeunload",()=>r({isHidden:!0,reason:"beforeunload"})),window.addEventListener("focus",()=>r({isHidden:!1})),window.addEventListener("blur",()=>r({isHidden:!0,reason:"blur"})),window.addEventListener("pageshow",()=>r({isHidden:!1})),window.addEventListener("pagehide",()=>r({isHidden:!0,reason:"pagehide"})),void 0!==document.hidden?document.addEventListener("visibilitychange",()=>r(document.hidden?{isHidden:!0,reason:"visibilitychange"}:{isHidden:!1}),!1):void 0!==document.webkitHidden&&document.addEventListener("webkitvisibilitychange",()=>r(document.webkitHidden?{isHidden:!0,reason:"visibilitychange"}:{isHidden:!1}),!1)},0);let o=a},77494:(e,t,n)=>{n.d(t,{Z:()=>et});var i=n(667294),a=n(532465),r=n(93501),o=n(30482),s=n(763795),l=n(39983),d=n(677263),p=n(41162),u=n(372453),c=n(363959),m=n(324e3),f=n(583077);let g=({constraintMap:e,initialNavTiming:t,annotations:n})=>({...n,...(0,f.jh)("constraint_",e),...(0,f.jh)("mark_",(0,l.gQ)()),...(0,f.jh)("browser_",{...t?(0,f.D3)(t):{},...(0,f.rX)()})});var y=n(577491),h=n(335741),v=n(769916);let T=(e,t)=>{let{firstInputDelay:n}=(0,h.v2)();return[...e.map(e=>(0,y.Z)(e,t)).filter(Boolean),...n?[{name:"fid",id:(0,v.Z)(),parentId:t,startTime:n.startTime,endTime:n.endTime,annotationMap:{},binaryAnnotationMap:{}}]:[]]};var w=n(40660),_=n(813107);let A=e=>e<=2500?"Good":e>2500&&e<=4e3?"Needs Improvement":"Poor",E=({eventPrefix:e,endTime:t,tags:n,resourceArr:i,resourceType:a="allResources"})=>{let r=i.length;if(r>0&&"object"==typeof i[0]&&!Array.isArray(i[0])){let o=[...i].sort((e,t)=>e.fetchStart-t.fetchStart),s=[...i].sort((e,t)=>e.responseEnd-t.responseEnd),l=1,d=t/5,p=0;for(;l<=5;){let t=0;for(;p<=r-1&&o[p].fetchStart<=d*l;)p+=1,t+=1;w.Z.gauge(`${e}.tags.${a}.fetchStartInterval${l}of5`,t,.2,n),w.Z.gauge(`${e}.${a}.fetchStartInterval${l}of5`,t,.2),l+=1}let u={zeroPercentInFlight:o[0].fetchStart,twentyFivePercentInFlight:o[Math.floor(r/4)].fetchStart,fiftyPercentInFlight:o[2*Math.floor(r/4)].fetchStart,seventyFivePercentInFlight:o[3*Math.floor(r/4)].fetchStart,hundredPercentInFlight:o[r-1].fetchStart,twentyFivePercentComplete:s[Math.floor(r/4)].responseEnd,fiftyPercentComplete:s[2*Math.floor(r/4)].responseEnd,seventyFivePercentComplete:s[3*Math.floor(r/4)].responseEnd,hundredPercentComplete:s[r-1].responseEnd};for(let t in u)u[t]&&(w.Z.timing(`${e}.tags.${a}.${t}`,u[t],.2,n),w.Z.timing(`${e}.${a}.${t}`,u[t],.2))}},S=({annotateExperiments:e,endTime:t,entries:n,metricId:i,pwtStaticContext:a})=>{let r=`${(0,_.Z)(a)}.${i.surface}`,o=[r];e&&e.forEach(e=>{let t=a.getExperimentGroup(e)||"null";o.push(`${r}.${e}.${t}`)});let s=A((0,h.Bn)()),l={lcpTimingBucket:s||"unknown",isAuthenticated:a.isAuthenticated,navigationType:i.navigationType},d=Array.from(n.filter(e=>"number"==typeof e.encodedBodySize&&e.encodedBodySize>=1e4&&e.responseEnd<=t)),p=[],u=[],c=[],m=[],f=[];d.forEach(e=>{"img"===e.initiatorType?p.push(e):"css"===e.initiatorType?u.push(e):"script"===e.initiatorType?c.push(e):"xmlhttprequest"===e.initiatorType?m.push(e):"link"===e.initiatorType&&e.name.includes("i.pinimg.com")&&f.push(e)}),o.forEach(e=>{E({eventPrefix:e,endTime:t,tags:l,resourceArr:d}),E({eventPrefix:e,endTime:t,tags:l,resourceArr:p,resourceType:"image"}),E({eventPrefix:e,endTime:t,tags:l,resourceArr:u,resourceType:"css"}),E({eventPrefix:e,endTime:t,tags:l,resourceArr:c,resourceType:"scripts"}),E({eventPrefix:e,endTime:t,tags:l,resourceArr:m,resourceType:"xhr"}),E({eventPrefix:e,endTime:t,tags:l,resourceArr:f,resourceType:"preloadedImage"})})};var I=n(353335);let M=({startTime:e,responseEnd:t},n)=>e>n.endTime||!!t&&t<n.startTime,b=({annotateExperiments:e,annotations:t,binaryAnnotations:n,constraintMap:i,endTime:a,imageTimings:r,metricId:o,pwtStaticContext:s,startTime:l,traceId:d,spans:p})=>{let f;let y=(0,I.Cg)();"initial_app_load"===o.navigationType&&(f=(0,c.Z)());let h=r.map(({name:e})=>e),v=y.map(e=>(0,m.p)(e,h)).filter(({timing:e})=>!M(e,{startTime:l,endTime:a}));return("board"===o.surface||"pin_closeup"===o.surface)&&S({annotateExperiments:e,endTime:a,entries:y,metricId:o,pwtStaticContext:s}),{type:"COMPLETE",traceId:d,startTime:l,endTime:a,spans:T(v,d).concat(p),annotationMap:g({constraintMap:i,initialNavTiming:f,annotations:t}),binaryAnnotationMap:(0,u.rA)({annotateExperiments:e,binaryAnnotations:n,entries:y,metricId:o,performanceResources:v,pwtEndTime:a,pwtStaticContext:s})}},C=!1,L=(e,t)=>{if(e&&t){if(!C)return C=!0,t;(0,s.H)("duplicated_initial_app_load_surface_pwt")}return(0,v.Z)()};var N=n(591614),R=n(361905);let P=e=>{let t=performance.getEntriesByType("resource").filter(e=>e.name.includes("i.pinimg")).reduce((e,t)=>{let n=t.name.replace(".jpg","").split("/");return{[n[n.length-1]]:{downloadSize:t.name.split("/")[3].split("x")[0]},...e}},{}),n=Array.from(document.getElementsByTagName("img")).map(e=>{let n=e.src.replace(".jpg","").split("/"),i=n[n.length-1];if(t[i]){var a;let n=(null===(a=(0,R.rZ)(e))||void 0===a?void 0:a.width)||1,r=t[i].downloadSize;return{fileName:i,renderedSize:n,downloadedSize:r,ratio:r/n}}return{fileName:i,renderedSize:1,downloadedSize:1,ratio:1}}),i=Array.from(document.querySelectorAll('div[role="img"]')).map(e=>{let n=e.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),i=n[n.length-1];if(t[i]&&e instanceof HTMLDivElement){var a;let n=(null===(a=(0,R.rZ)(e))||void 0===a?void 0:a.width)||1,r=t[i].downloadSize;return{fileName:i,renderedSize:n,downloadedSize:r,ratio:r/n}}return{fileName:i,renderedSize:1,downloadedSize:1,ratio:1}});[...n,...i].forEach(t=>{let{ratio:n,fileName:i,downloadedSize:a}=t;t.ratio>1.05&&(0,s.A9)(`checkImageRatio.${e}`,{count:Math.round(10*n)/10,tags:{fileName:`${a}_${i}`}})})};var O=n(622200),$=n(282802);let Z=(e,t)=>{let n=(0,i.useRef)(t);return{getState:()=>n.current,dispatch:t=>{n.current=e(n.current,t)}}};var H=n(694952),B=n(935340),D=n(785893);let k=["initial_app_load","client_route_push"],z=(0,o.XV)("PwtSurface"),U="NavigationComplete",x="VisuallyComplete",G=(e,t)=>{e.isSampled&&(0,N.Z)({metricId:e.metricConfig.metricId,pwtStaticContext:e.metricConfig.pwtStaticContext,result:{type:"ABORT",reason:t}})},F=(e,t,n)=>{var i;let{metricConfig:{metricId:a,pwtStaticContext:o,annotateExperiments:d},annotations:p,binaryAnnotations:u,constraintMap:c,startTime:m,imageTimings:f,isSampled:g,spans:y}=e;(0,l.L8)(`PWT_Complete_${(0,r.KJ)(a)}`);let h=L("initial_app_load"===a.navigationType,null===(i=o.serverData)||void 0===i?void 0:i.trace_id),v=b({annotateExperiments:d,annotations:p,binaryAnnotations:u,constraintMap:c,endTime:t,imageTimings:f,metricId:a,pwtStaticContext:o,startTime:m,traceId:h,spans:y});g&&!n&&(0,N.Z)({metricId:a,pwtStaticContext:o,result:v});try{P(String(v.binaryAnnotationMap["metricId.surface"].value))}catch(e){(0,s.H)("image_ratio_check_error",{error:e})}return{...e,result:v,status:"DONE"}},j=(e,t)=>{if(e.metricConfig.constraints.every(t=>e.constraintMap[t])){let n=Math.max(...e.metricConfig.constraints.map(t=>e.constraintMap[t]));return F(e,n,t)}return e},K=(e,t)=>{let{constraint:n,time:i,disablePWTLogging:a}=t,o=(0,r.KJ)(e.metricConfig.metricId);return O.Z?e.metricConfig.constraints.find(e=>e===n)?e.constraintMap[n]?(z(`constraint "${n}" is already complete.`),(0,s.H)("duplicated_constraint_complete",{constraint:n,action:o}),e):(z(`marking constraint "${n}" as complete`),(0,l.ZP)(`constraint_${n}_is_complete`),j({...e,constraintMap:{...e.constraintMap,[n]:i||O.Z.now()}},a)):(z(`marked constraint "${n}" is not a required constraint.`),e):((0,s.H)("missing_window_performance",{action:o}),e)},J=(e,t)=>{if(!O.Z){let t=(0,r.KJ)(e.metricConfig.metricId);(0,s.H)("missing_window_performance",{action:t})}z(`removing constraint "${t}"`);let n=e.metricConfig.constraints.filter(e=>e!==t),{[t]:i,...a}=e.constraintMap;return j({...e,constraintMap:a,metricConfig:{...e.metricConfig,constraints:n}})},V=(e,t)=>{if(!O.Z){let t=(0,r.KJ)(e.metricConfig.metricId);(0,s.H)("missing_window_performance",{action:t})}z(`updating pwt segment to "${t}"`);let n={...e.metricConfig.metricId,segment:t};return{...e,metricConfig:{...e.metricConfig,metricId:n}}},W=(e,t)=>{let{metricConfig:n,startTime:i,isSampled:a,disablePWTLogging:o}=t;if(o||"TIMING"!==e.status||i===e.startTime||G(e,"routeUpdatedOnSameSurface"),!n)return{status:"DISABLED",metricConfig:null};let l=(0,r.KJ)(n.metricId);if("TIMING"===e.status&&e.startTime===i&&e.constraintMap[U])return(0,s.H)("duplicated_init_route_action",{action:l}),e;if(!o){if("Other"===n.pwtStaticContext.browserName&&!1===n.metricId.isAuthenticated&&"initial_app_load"===n.metricId.navigationType){var d,p,u,c;(0,s.A9)(`TIMING.${l}`,{tags:{userAgent:null===(d=window)||void 0===d?void 0:null===(p=d.navigator)||void 0===p?void 0:p.userAgent}}),(0,s.A9)(`TIMING.sampled.${l}`,{tags:{userAgent:null===(u=window)||void 0===u?void 0:null===(c=u.navigator)||void 0===c?void 0:c.userAgent},sampleRate:.5})}else(0,s.A9)(`TIMING.${l}`),(0,s.A9)(`TIMING.sampled.${l}`,{sampleRate:.5})}return K({status:"TIMING",metricConfig:n,startTime:i,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:a,spans:[]},{constraint:U,disablePWTLogging:o})},Y=(e,t)=>{if(z("dispatch action",t),"INIT_ROUTE"===t.type)return W(e,t.payload);if("TIMING"!==e.status)return z(`ignoring action due to invalid state ${e.status}`,t),e;switch(t.type){case"ABORT":G(e,t.reason);let n={type:"ABORT",reason:t.reason};return{...e,status:"DONE",result:n};case"ANNOTATE":let{name:i}=t.payload;if(!O.Z)return e;let a=O.Z.now();return z(`adding annotation {${i}: ${a}}`),{...e,annotations:{...e.annotations,[i]:a}};case"BINARY_ANNOTATE":let{name:o,value:l,annotationType:d}=t.payload;return z(`adding binary annotation {${o}: ${l}}`),{...e,binaryAnnotations:{...e.binaryAnnotations,[o]:{value:l,type:d}}};case"MARK_CONSTRAINT_COMPLETE":return K(e,t.payload);case"REMOVE_CONSTRAINT":return J(e,t.payload);case"SET_SEGMENT":return V(e,t.payload);case"SET_VISUALLY_COMPLETE_RESULT":{let{payload:{imageTimings:n}}=t;if(0===n.length)return G(e,"visuallyComplete_noImages"),{...e,status:"DONE",result:{type:"ABORT",reason:"visuallyComplete_noImages"}};let i=Math.max(...n.map(e=>e.responseEnd||0));return K({...e,imageTimings:n},{constraint:x,time:i})}case"ADD_SUBSPAN":let{startTime:p}=e,{payload:{name:u,startTime:c,endTime:m,annotations:f,binaryAnnotations:g,parentId:y}}=t;return{...e,spans:[...e.spans,{name:u,id:(0,v.Z)(),startTime:c||p,endTime:m,annotationMap:{...f},binaryAnnotationMap:{...g},parentId:y}]};case"START_SUBSPAN":return{...e,spans:[...e.spans,{name:t.payload.name,id:(0,v.Z)(),startTime:O.Z?O.Z.now():0,endTime:1/0,annotationMap:{...t.payload.annotations},binaryAnnotationMap:{...t.payload.binaryAnnotations},parentId:t.payload.parentId}]};case"STOP_SUBSPAN":let h=e.spans.findIndex(e=>e.name===t.payload.name);return h>-1?(e.spans[h].endTime=O.Z?O.Z.now():0,t.payload.annotations&&(e.spans[h].annotationMap={...e.spans[h].annotationMap,...t.payload.annotations}),t.payload.binaryAnnotations&&(e.spans[h].binaryAnnotationMap={...e.spans[h].binaryAnnotationMap,...t.payload.binaryAnnotations})):(0,s.H)("invalid_subspan_stop_name",{name:t.payload.name}),e;default:let T=(0,r.KJ)(e.metricConfig.metricId);return(0,s.H)("invalid_pwt_surface_action",{action:T}),e}},q=e=>{if(!e)return"initial_app_load";switch(e.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}},X=new Set,Q=({surface:e,constraints:t,segment:n,measureGridVisuallyComplete:r,annotateExperiments:o,customEnabledNavigationTypes:s,navigationInfo:{clientNavigation:l,navigationType:p},sampleRate:u})=>{let c=(0,i.useRef)("NOT_SET"),m=(0,d.N5)(),{getState:f,dispatch:g}=Z(Y,{status:"DISABLED",metricConfig:null}),y=(0,$.B)();if(c.current!==l&&(c.current=l,m)){let{isAuthenticated:i}=m,a=e&&p&&(s||k).includes(p)?{metricId:{type:"surface",surface:e,navigationType:p,isAuthenticated:i,segment:n},annotateExperiments:o,constraints:[U,...t||[],...r?[x]:[]],pwtStaticContext:m}:null;(0,B.nP)("webapp.pwt_surface.init_route",{tags:{surface:e,navigationType:p,isAuthenticated:i}});let d=!X.has(l);g({type:"INIT_ROUTE",payload:{metricConfig:a,startTime:l?l.time:0,isSampled:!u||Math.random()<u,disablePWTLogging:!d}}),d&&X.add(l)}let h=f();if((0,i.useEffect)(()=>()=>{X.delete(l)},[l]),(0,i.useEffect)(()=>{let e=e=>{g({type:"ABORT",reason:e})};a.Z.onSessionPause(e);let t=window.innerHeight,n=window.innerWidth,i=()=>{var e,a,r;let o=Math.abs(window.innerHeight-t),s=Math.abs(window.innerWidth-n),l=window.innerHeight!==t,d=window.innerWidth!==n,p={handler:(0,H.H)(),deviceType:null!==(e=null==m?void 0:m.deviceType)&&void 0!==e?e:"unknown",isAuthenticated:null!==(a=null==m?void 0:m.isAuthenticated)&&void 0!==a?a:"unknown",platform:null!==(r=y.userAgent.platform)&&void 0!==r?r:"unknown"};(0,B.nP)("webapp.PwtLogger.handleResize",{sampleRate:1,tags:{...p,heightChanged:l,widthChanged:d}}),l&&(0,B.S0)("webapp.PwtLogger.resizeHeightDelta",o,{sampleRate:1,tags:p}),d&&(0,B.S0)("webapp.PwtLogger.resizeWidthDelta",s,{sampleRate:1,tags:p}),window.removeEventListener("resize",i);let u=(null==m?void 0:m.deviceType)==="phone"&&(!d&&l&&o<=150||!l&&!d)||(null==m?void 0:m.deviceType)==="desktop"&&!l&&!d;if(u){(0,B.nP)("webapp.PwtLogger.skipResizeAbort",{sampleRate:1,tags:{...p,heightChanged:l,widthChanged:d}});return}g({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",i),()=>{let t=f();z("handling unmount",t),"TIMING"===t.status&&G(t,"unmount"),a.Z.removePauseListener(e),window.removeEventListener("resize",i)}},[]),"TIMING"!==h.status||!h.constraintMap[U])return{state:h,context:null};let{startTime:v,metricConfig:T}=h;return{state:h,context:{abort:e=>g({type:"ABORT",reason:e}),addAnnotation:e=>g({type:"ANNOTATE",payload:{name:e}}),addBinaryAnnotation:(e,t,n)=>g({type:"BINARY_ANNOTATE",payload:{name:e,value:t,annotationType:n}}),addSubspan:(e,t,n,i={},a={},r=null)=>g({type:"ADD_SUBSPAN",payload:{name:e,startTime:t,endTime:n,annotations:i,binaryAnnotations:a,parentId:r}}),getId:()=>v,getMetricId:()=>T.metricId,markConstraintComplete:e=>g({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:e,time:O.Z?O.Z.now():0}}),removeConstraint:e=>g({type:"REMOVE_CONSTRAINT",payload:e}),setSegment:e=>g({type:"SET_SEGMENT",payload:e}),setVisuallyCompleteResult:T.constraints.includes(x)?e=>g({type:"SET_VISUALLY_COMPLETE_RESULT",payload:e}):null,startSubspan:(e,t={},n={},i=null)=>g({type:"START_SUBSPAN",payload:{name:e,annotations:t,binaryAnnotations:n,parentId:i}}),stopSubspan:(e,t={},n={},i=null)=>g({type:"STOP_SUBSPAN",payload:{name:e,annotations:t,binaryAnnotations:n,parentId:i}})}}},ee=()=>{let e=(0,p.E)(),t=!!e;(0,i.useEffect)(()=>{if(t){let t=null==e?void 0:e.getMetricId(),n=t?(0,r.KJ)(t):null;(0,s.H)("nested_pwt_surface",{action:n})}},[t])};function et({children:e,...t}){var n;let i=(0,d.fM)(),a=q(i),r=[...null!==(n=t.annotateExperiments)&&void 0!==n?n:[]],o={...t,annotateExperiments:r,navigationInfo:{navigationType:a,clientNavigation:i}},{context:s}=Q(o);return ee(),(0,D.jsx)(p.S,{value:s,children:e})}},768337:(e,t,n)=>{n.d(t,{Z:()=>i});let i=e=>{switch(e){case"BR":case"MX":case"AR":case"CL":case"CO":return"LatAm";case"US":return"US";case"CA":return"CA";case"GB":return"GB";case"FR":return"FR";case"DE":return"DE";default:return"OTHER"}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/24321-935c78386d81fe8b.mjs.map